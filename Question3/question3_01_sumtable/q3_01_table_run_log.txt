> ###############################################################################
> # Question 3: TLG â€“ Adverse Events Reporting - Summary Table
> # Program: question_3_tlg/01_create_ae_summary_table.R
> # Purpose: Create an FDA-style Table 10 summary of Treatment-Emergent
> #          Adverse Events (TEAEs) using the pharmaverseadam ADAE and ADSL datasets.
> #          The table summarizes the number and percentage of subjects experiencing
> #          at least one TEAE by treatment group, following FDA TLG guidance.
> # Output: AE summary table in HTML + PDF format
> # Notes/ Reminders:
> #            - ADAE: event-level adverse event records (used for numerators)
> #            - ADSL: analysis population / treatment groups (used for denominators)
> ###############################################################################
> 
> # -------------- Load required packages ---------------------------------------
> library(dplyr)
> library(gtsummary)
> library(gt)
> library(pharmaverseadam)
> 
> ## ---- Load input datasets ----------------------------------------------------
> adae <- pharmaverseadam::adae
> adsl <- pharmaverseadam::adsl
> 
> ## ---- Check contents of adsl and adae ---------------------------------------
> # Check which dataset varibles of interest are in
> sum(colnames(adae) %in% c("AETERM", "AESOC", "ACTARM"))
[1] 3
> sum(colnames(adsl) %in% c("AETERM", "AESOC", "ACTARM")) # ACTARM in both datasets
[1] 1
> 
> ## ---- Restrict to TEAEs ------------------------------------------------------
> adae_tbl_data <- adae %>%
+   filter(TRTEMFL == "Y")
> 
> ## ---- Add Total treatment group (last column) --------------------------------
> # Create Total denominator (ADSL) and Total numerator (ADAE) so that
> # the Total column uses the correct overall denominator.
> 
> adsl_total <- adsl %>%
+   mutate(ACTARM = "Total")
> 
> adae_tbl_data_total <- adae_tbl_data %>%
+   mutate(ACTARM = "Total")
> 
> # Combine original + Total
> adsl_den_all <- bind_rows(adsl, adsl_total)
> adae_tbl_all <- bind_rows(adae_tbl_data, adae_tbl_data_total)
> 
> # Force Total column to appear last (use treatment order from ADSL)
> arm_levels <- c(unique(adsl$ACTARM), "Total")
> 
> adsl_den_all <- adsl_den_all %>%
+   mutate(ACTARM = factor(ACTARM, levels = arm_levels))
> 
> adae_tbl_all <- adae_tbl_all %>%
+   mutate(ACTARM = factor(ACTARM, levels = arm_levels))
> 
> ## ---- Create AE summary table ------------------------------------------------
> # Primary System Organ Class (AESOC) and Preferred Term (AETERM)
> # n (%) = number (percent) of subjects with >=1 TEAE in the SOC/PT,
> # where percent uses the ADSL denominator within each treatment arm.
> 
> ae_table <- adae_tbl_all %>%
+   tbl_hierarchical(
+     variables = c(AESOC, AETERM), # hierarchy
+     by = ACTARM,                  # treatment group columns
+     id = USUBJID,                 # subject-level counting
+     denominator = adsl_den_all,   # denominators (ADSL)
+     overall_row = TRUE,           # "Any TEAE" row
+     label = list(
+       ..ard_hierarchical_overall.. = "Any TEAE",
+       AESOC = "System Organ Class",
+       AETERM = "Preferred Term"
+     )
+   ) %>%
+   # Sort table by frequency in descending order
+   sort_hierarchical(sort = "descending")
> 
> ## ---- Saving summary table as HTML ------------------------------------------
> as_gt(ae_table) %>%
+   tab_header(
+     title = "Summary of Treatment-Emergent Adverse Events (TEAE)"
+   ) %>%
+   gtsave("Question3/question3_01_sumtable/AE_summary_table.html")
> 
> ## ---- Saving summary table as PDF -------------------------------------------
> as_gt(ae_table) %>%
+   tab_header(
+     title = "Summary of Treatment-Emergent Adverse Events (TEAE)"
+   ) %>%
+   gtsave("Question3/question3_01_sumtable/AE_summary_table.pdf")


Ran with no errors !! Yay :)
